# Remediation script for Intune proactive remediation

# Define the registry paths and value name
$path1 = "HKLM:\Software\Microsoft\Cryptography\Wintrust\Config"
$path2 = "HKLM:\Software\Wow6432Node\Microsoft\Cryptography\Wintrust\Config"
$name = "EnableCertPaddingCheck"
$value = "1"

# Function to delete and recreate registry key with REG_SZ value
function Set-RegistryValueAsString {
    param (
        [string]$path,
        [string]$name,
        [string]$value
    )

    # Delete the registry value if it exists
    if (Test-Path -Path $path) {
        Remove-ItemProperty -Path $path -Name $name -ErrorAction SilentlyContinue
    }

    # Ensure the registry path exists
    if (-not (Test-Path -Path $path)) {
        New-Item -Path $path -Force | Out-Null
    }

    # Create the registry value as REG_SZ
    New-ItemProperty -Path $path -Name $name -Value $value -PropertyType String -Force | Out-Null
}

# Set the registry values
Set-RegistryValueAsString -path $path1 -name $name -value $value
Set-RegistryValueAsString -path $path2 -name $name -value $value

Write-Output "Remediation complete"
